$(document).ready(function(){if(!$('body').hasClass('toc')){return;}
var makeCatAbbUI=function(){var catAbb=$('#catAbb'),catAbbUI=catAbb.clone()
.attr({id:'catAbbUI',name:''}),acat=catAbb.find('option:selected')
.data('acat');if(acat){catAbbUI.val(acat);}
catAbbUI.find('option[data-acat]').remove();catAbb.hide().after(catAbbUI);}
makeCatAbbUI();$('#catAbbUI').on('change',function(e){flipCatAndSubmit($('#catAbbUI').find('option:selected').val());});$('#catAbb, input.min, input.max').prop('disabled',false);var viewMode=function(mode){if(mode==='map'){if(!isMapMode){$('#zoomtoposting').val('');$('#useMap').prop('checked',true);$('#searchform').submit();}}else{imgCookie(mode);if(isMapMode){$('#useMap').prop('checked',false);$('#searchform').submit();return;}
$body.removeClass('list pic grid').addClass(mode);if(mode=='list'){$('p.row').show();}else if(mode=='pic'){$('p.row').show();addFloater();populateImageSpans('50x50c');markEmtpyThumbnails();}else if(mode=='grid'){removeFloater();populateImageSpans('300x300');markEmtpyThumbnails();}}};var addFloater=function(){var $floater=$('#floater');var $payload=$floater.find('img.payload');var visible=false;if(!$body.hasClass('mobile')){$('.i').on('mouseover',function(){var imgID=$(this).data('id');if(imgID){$floater.show();$payload.attr('src',imgURL(imgID,'300x300'))
.on('load',function(){$('#floater').addClass('f');});visible=true;}})
.on('mouseout',function(){$floater.hide().removeClass('f');$payload.attr('src','');visible=false;})
.on('mousemove',function(e){if(visible){$('#floater').css({'left':e.pageX+15+'px','top':e.pageY+15+'px'});}});}}
var removeFloater=function(){$('.i').off();$('#floater').hide();}
var markEmtpyThumbnails=function(){$('p.row .i').not('[data-id]').addClass('empty').attr('title','no image');};var countHoods=function(){$('span#hoodcount').text($('#nh :checked').length||$('#nh :selected').length||'all');};var toggleHoods=function(){$('#hoodtogon, #hoodtogoff').toggle();$('#nh').slideToggle(100);$('select#nh').toChecklist({addScrollBar:false,showSelectedItems:true,submitDataAsArray:false});$('#nh').on('click',countHoods);countHoods();};var viewModes={};var imgCookie=function(val,time){var cookieName='cl_img';var mode;if(typeof val==='undefined'){mode=CL.cookies.getItem(cookieName);if(mode){mode.split(',').forEach(function(tuple){tuple=tuple.split(':');if(tuple.length===1){viewModes[catType]=tuple[0];}else{viewModes[tuple[0]]=tuple[1];}});mode=viewModes[catType];}
mode=mode==='show'?'pic':mode;return mode||(pagemode==='mobile'?'pic':'list');}else{var date=new Date();time=time||date.getTime();date.setTime(time+(365*24*60*60*1000));viewModes[catType]=val;var allCatModes=Object.keys(viewModes).map(function(cat){return cat+':'+viewModes[cat];}).join(',');CL.cookies.removeItem(cookieName,{path:'/'});CL.cookies.setItem(cookieName,allCatModes,{expires:date,path:'/',domain:CL.url.baseDomain});}};var populateImageSpans=function(size){size=size||'50x50c';$('.i').each(function(){var img_id=$(this).data('id');if(img_id){$(this).html('<img alt="" src="'+imgURL(img_id,size)+'">');}});};var imgURL=function(img_id,size){var cPos=img_id.indexOf(':');return imageHost+'/'+img_id.substr(cPos+1)+'_'+size+'.jpg';};var getSubarea=function(url){var match=url.match(/\/search\/...\/(...)/);if(match){return match[1];}
match=url.match(/\/(...)\/...\//);if(match){return match[1];}};var flipCatAndSubmit=function(cat){$('#searchform').find('#catAbb').val(cat).end().submit();};var $body=$('body');var modeToShow=imgCookie();var isMapMode=$body.hasClass('map');if(isMapMode){modeToShow='map';}
viewMode(modeToShow);if($.fn.DefaultValue){$('input.min').DefaultValue('min');$('input.max').DefaultValue('max');$('#query').DefaultValue('search');}
$('#catAbb').change(function(){if(isMapMode){$('#searchform').attr('action','/search/'+$('#catAbb').val());}
$('#searchform').submit();});$('#nh').hide().removeAttr('disabled');newSel=$('#nh').clone();newSel.find('#all').remove();$('#nh').replaceWith(newSel);$('#hoodtogon, #hoodtitle').show();$('#hoodtitle').click(function(e){e.preventDefault;toggleHoods();});countHoods();$body.on('click',function(e){if(!$(e.target).parents('#hoodpicker').length){$('#hoodtogon').show();$('#hoodtogoff').hide();$('#nh').slideUp(100);}});$('#satabs a').on('click',function(e){e.preventDefault();var f=$('#searchform');var t=f.attr('action').match(/\/search\/.../);var s=getSubarea($(this).attr('href'));if(s){t=t+"/"+s;}
f.attr('action',t);$('select#nh').prop('disabled',true);f.submit();});$("a.gc,#searchlegend a").click(function(e){e.preventDefault();flipCatAndSubmit($(this).data('cat'));});$('#'+modeToShow+'view').addClass('down');if($('div.container').html()){$('#toc_rows blockquote').first().hide();}
var $modeButtons=$('.modebtns button');$modeButtons.on('click',function(e){var $this=$(this);if($this.hasClass('down')){return;}
e.preventDefault();var newMode=$this.attr('id').replace('view','');$modeButtons.removeClass('down');$this.addClass('down');viewMode(newMode);});$('span.itemsfound').prependTo('div.container');$('a.maptag').click(function(){var mapTagPostingID=$(this).data('pid');$('#useMap').prop('checked',true);$('#zoomtoposting').val(mapTagPostingID);$('#searchform').submit();});});